apiVersion: extensions/v1beta1
kind: DaemonSet
metadata:
  name: honeycomb-agent
  namespace: kube-system
  labels:
    k8s-app: honeycomb-agent
    kubernetes.io/cluster-service: "true"
    version: v1.1
spec:
  template:
    metadata:
      # unlike pod-nginx.yaml, the name is not included in the meta data as a unique name is
      # generated from the deployment name
      labels:
          k8s-app: honeycomb-agent
    spec:
      containers:
        - name: honeycomb-kubernetes-agent
          image: honeycomb-kubernetes-agent
          env:
          - name: NODE_NAME
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          volumeMounts:
          - name: config
            mountPath: /etc/honeycomb
          - name: varlog
            mountPath: /var/log
          - name: varlibdockercontainers
            mountPath: /var/lib/docker/containers
            readOnly: true
      volumes:
      - name: config
        configMap:
          name: honeycomb-agent-config
          items:
            - key: config.yaml
              path: config.yaml
      - name: varlog
        hostPath:
          path: /var/log
      - name: varlibdockercontainers
        hostPath:
          path: /var/lib/docker/containers
